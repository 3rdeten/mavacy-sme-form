<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subject Matter Expert Knowledge Transfer | Mavacy</title>
  <style>
    :root {
      --mavacy-navy: #1a2332;
      --mavacy-blue: #2c5282;
      --mavacy-accent: #4299e1;
      --mavacy-gold: #d69e2e;
      --mavacy-light: #f7fafc;
      --mavacy-gray: #718096;
      --mavacy-dark-gray: #4a5568;
      --mavacy-border: #e2e8f0;
      --mavacy-success: #48bb78;
      --mavacy-white: #ffffff;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
      --radius: 8px;
      --radius-lg: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--mavacy-light);
      color: var(--mavacy-navy);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--mavacy-navy) 0%, var(--mavacy-blue) 100%);
      color: var(--mavacy-white);
      padding: 2rem 1.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(66,153,225,0.15) 0%, transparent 70%);
      border-radius: 50%;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
      position: relative;
    }

    .header p {
      font-size: 0.95rem;
      opacity: 0.85;
      max-width: 640px;
      margin: 0 auto;
      position: relative;
    }

    .header .badge {
      display: inline-block;
      background: rgba(214,158,46,0.2);
      border: 1px solid var(--mavacy-gold);
      color: var(--mavacy-gold);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      margin-bottom: 0.75rem;
    }

    /* Layout */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    /* Step progress */
    .step-progress {
      background: var(--mavacy-white);
      border-radius: var(--radius-lg);
      padding: 1.25rem 1.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--mavacy-border);
    }

    .step-progress .step-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: var(--mavacy-gray);
      margin-bottom: 0.75rem;
    }

    .step-progress .step-label strong {
      color: var(--mavacy-navy);
      font-weight: 600;
    }

    .step-progress .track {
      background: var(--mavacy-border);
      height: 6px;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .step-progress .fill {
      background: linear-gradient(90deg, var(--mavacy-accent), var(--mavacy-blue));
      height: 100%;
      border-radius: 3px;
      transition: width 0.4s ease;
      width: 0%;
    }

    .step-dots {
      display: flex;
      justify-content: space-between;
      padding: 0 0.25rem;
    }

    .step-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--mavacy-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--mavacy-gray);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .step-dot.active {
      background: var(--mavacy-accent);
      color: var(--mavacy-white);
      box-shadow: 0 2px 8px rgba(66,153,225,0.4);
    }

    .step-dot.completed {
      background: var(--mavacy-success);
      color: var(--mavacy-white);
    }

    /* Sections */
    .section {
      background: var(--mavacy-white);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--mavacy-border);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .section-number {
      background: var(--mavacy-blue);
      color: var(--mavacy-white);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .section h2 {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--mavacy-navy);
    }

    .section-description {
      color: var(--mavacy-gray);
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
      padding-left: 2.75rem;
    }

    /* Form elements */
    .field {
      margin-bottom: 1.5rem;
    }

    .field:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--mavacy-navy);
      margin-bottom: 0.4rem;
    }

    label .hint {
      font-weight: 400;
      color: var(--mavacy-gray);
      font-size: 0.825rem;
    }

    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      padding: 0.7rem 1rem;
      border: 1.5px solid var(--mavacy-border);
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-family: inherit;
      color: var(--mavacy-navy);
      background: var(--mavacy-white);
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--mavacy-accent);
      box-shadow: 0 0 0 3px rgba(66,153,225,0.15);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }

    textarea.large {
      min-height: 180px;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23718096' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 2.5rem;
    }

    .required::after {
      content: ' *';
      color: #e53e3e;
    }

    /* Navigation buttons */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.5rem;
      gap: 1rem;
    }

    .nav-buttons .left {
      display: flex;
      gap: 0.75rem;
    }

    .nav-buttons .right {
      display: flex;
      gap: 0.75rem;
    }

    .btn {
      padding: 0.8rem 1.75rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--mavacy-blue), var(--mavacy-accent));
      color: var(--mavacy-white);
      box-shadow: 0 2px 8px rgba(44,82,130,0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 4px 16px rgba(44,82,130,0.4);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--mavacy-white);
      color: var(--mavacy-blue);
      border: 1.5px solid var(--mavacy-blue);
    }

    .btn-secondary:hover {
      background: rgba(44,82,130,0.05);
    }

    .btn-success {
      background: var(--mavacy-success);
      color: var(--mavacy-white);
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-outline {
      background: transparent;
      color: var(--mavacy-gray);
      border: 1.5px solid var(--mavacy-border);
    }

    .btn-outline:hover {
      border-color: var(--mavacy-gray);
      color: var(--mavacy-dark-gray);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-save-exit {
      background: transparent;
      color: var(--mavacy-gray);
      border: 1.5px solid var(--mavacy-border);
      font-size: 0.85rem;
      padding: 0.6rem 1.25rem;
    }

    .btn-save-exit:hover {
      border-color: var(--mavacy-gray);
      color: var(--mavacy-dark-gray);
    }

    /* Welcome screen */
    .welcome-screen {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .welcome-screen.active {
      display: block;
    }

    .welcome-card {
      background: var(--mavacy-white);
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--mavacy-border);
      text-align: center;
    }

    .welcome-card h2 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: var(--mavacy-navy);
    }

    .welcome-card p {
      font-size: 0.95rem;
      color: var(--mavacy-dark-gray);
      max-width: 540px;
      margin: 0 auto 1.5rem;
    }

    .welcome-features {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0 2rem;
      text-align: left;
    }

    .welcome-feature {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--mavacy-light);
      border-radius: var(--radius);
    }

    .welcome-feature .icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(66,153,225,0.1);
      color: var(--mavacy-accent);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 1rem;
    }

    .welcome-feature .text {
      font-size: 0.85rem;
      color: var(--mavacy-dark-gray);
    }

    .welcome-feature .text strong {
      display: block;
      color: var(--mavacy-navy);
      margin-bottom: 0.15rem;
      font-size: 0.9rem;
    }

    .welcome-resume {
      background: linear-gradient(135deg, #ebf8ff 0%, #f0fff4 100%);
      border: 1px solid #bee3f8;
      border-radius: var(--radius);
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      display: none;
      text-align: center;
    }

    .welcome-resume p {
      font-size: 0.9rem;
      color: var(--mavacy-blue);
      margin: 0;
    }

    /* Submitting spinner */
    .btn-primary:disabled {
      opacity: 0.7;
    }

    /* Completion screen */
    .completion-screen {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .completion-screen.active {
      display: block;
    }

    .completion-card {
      background: var(--mavacy-white);
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--mavacy-border);
      text-align: center;
    }

    .completion-card .check-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(72,187,120,0.1);
      color: var(--mavacy-success);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.25rem;
      font-size: 2rem;
    }

    .completion-card h2 {
      font-size: 1.3rem;
      margin-bottom: 0.75rem;
      color: var(--mavacy-navy);
    }

    .completion-card p {
      font-size: 0.95rem;
      color: var(--mavacy-dark-gray);
      max-width: 480px;
      margin: 0 auto 1.5rem;
    }

    .completion-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--mavacy-navy);
      color: var(--mavacy-white);
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius);
      font-size: 0.9rem;
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .header h1 { font-size: 1.25rem; }
      .header { padding: 1.5rem 1rem; }
      .container { padding: 1.25rem 1rem 3rem; }
      .section { padding: 1.5rem; }
      .welcome-card { padding: 1.5rem; }
      .welcome-features { grid-template-columns: 1fr; }
      .nav-buttons { flex-direction: column; }
      .nav-buttons .left, .nav-buttons .right { width: 100%; }
      .nav-buttons .left { order: 2; }
      .nav-buttons .right { order: 1; }
      .btn { width: 100%; justify-content: center; }
      .completion-actions { flex-direction: column; align-items: center; }
      .step-dot { width: 24px; height: 24px; font-size: 0.7rem; }
    }

    /* Print styles */
    @media print {
      .header, .step-progress, .nav-buttons, .preview-actions, .toast, .welcome-screen, .completion-actions { display: none; }
      .preview-panel { box-shadow: none; border: none; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="badge">Mavacy Knowledge System</div>
    <h1>Subject Matter Expert Knowledge Transfer</h1>
    <p>Help us capture your expertise. Your knowledge will help us deliver better legal work, faster.</p>
  </div>

  <div class="container">

    <!-- Step progress bar -->
    <div class="step-progress" id="stepProgress" style="display:none;">
      <div class="step-label">
        <span><strong id="stepTitle">Step 1 of 8</strong></span>
        <span id="stepPercent">0%</span>
      </div>
      <div class="track">
        <div class="fill" id="stepFill"></div>
      </div>
      <div class="step-dots" id="stepDots"></div>
    </div>

    <!-- Welcome screen -->
    <div class="welcome-screen active" id="welcomeScreen">
      <div class="welcome-card">
        <h2>Welcome</h2>
        <p>We're going to walk through 8 short sections to capture your expertise. It takes about 15-20 minutes, and you can save your progress and come back anytime.</p>

        <div class="welcome-features">
          <div class="welcome-feature">
            <div class="icon">1</div>
            <div class="text">
              <strong>One section at a time</strong>
              No information overload &mdash; just answer what's in front of you.
            </div>
          </div>
          <div class="welcome-feature">
            <div class="icon">&#x1f4be;</div>
            <div class="text">
              <strong>Auto-saves your progress</strong>
              Close the tab anytime. Your answers will be here when you come back.
            </div>
          </div>
          <div class="welcome-feature">
            <div class="icon">&#x2713;</div>
            <div class="text">
              <strong>No wrong answers</strong>
              We want how <em>you</em> think about this area of law.
            </div>
          </div>
          <div class="welcome-feature">
            <div class="icon">&#x1f4c4;</div>
            <div class="text">
              <strong>Submit when done</strong>
              Your answers go straight to the Mavacy team.
            </div>
          </div>
        </div>

        <div class="welcome-resume" id="welcomeResume">
          <p>You have saved progress from a previous session. Pick up where you left off.</p>
        </div>

        <button class="btn btn-primary" onclick="startForm()" id="startBtn">Get Started</button>
      </div>
    </div>

    <!-- Form -->
    <form id="smeForm" autocomplete="off">

      <!-- Section 1: Expert Info -->
      <div class="section" data-step="1">
        <div class="section-header">
          <div class="section-number">1</div>
          <h2>About You</h2>
        </div>
        <p class="section-description">Tell us who you are and what you're an expert in.</p>

        <div class="field">
          <label for="expertName" class="required">Your Name</label>
          <input type="text" id="expertName" placeholder="e.g. Jane Smith" required>
        </div>

        <div class="field">
          <label for="expertTitle">Title / Role <span class="hint">(optional)</span></label>
          <input type="text" id="expertTitle" placeholder="e.g. Senior Corporate Attorney, Tax Consultant">
        </div>

        <div class="field">
          <label for="expertEmail">Email <span class="hint">(optional &mdash; for follow-up questions)</span></label>
          <input type="email" id="expertEmail" placeholder="jane@example.com">
        </div>

        <div class="field">
          <label for="expertiseArea" class="required">What is your area of expertise?</label>
          <input type="text" id="expertiseArea" placeholder="e.g. Corporate law, Tax consulting, Healthcare compliance, Real estate transactions" required>
        </div>

        <div class="field">
          <label for="experienceYears">Years of Experience in This Area <span class="hint">(optional)</span></label>
          <input type="text" id="experienceYears" placeholder="e.g. 15 years">
        </div>
      </div>

      <!-- Section 2: Scope & Application -->
      <div class="section" data-step="2">
        <div class="section-header">
          <div class="section-number">2</div>
          <h2>Scope &amp; Application</h2>
        </div>
        <p class="section-description">Help us understand when and how this expertise applies.</p>

        <div class="field">
          <label for="scope" class="required">What types of legal work does your expertise cover?</label>
          <textarea id="scope" placeholder="Describe the scope of work this expertise applies to. What types of matters, transactions, disputes, or client needs fall within this area?" required></textarea>
        </div>

        <div class="field">
          <label for="triggers" class="required">What common situations or client needs does your expertise address?</label>
          <textarea id="triggers" placeholder="Describe the kinds of situations, problems, or client requests where your expertise comes into play. What typically brings someone to you for help?" required></textarea>
        </div>
      </div>

      <!-- Section 3: Core Knowledge -->
      <div class="section" data-step="3">
        <div class="section-header">
          <div class="section-number">3</div>
          <h2>Core Knowledge</h2>
        </div>
        <p class="section-description">The most important things someone new to this area should know.</p>

        <div class="field">
          <label for="principles" class="required">What are the most important principles, rules, or considerations in this area?</label>
          <textarea id="principles" class="large" placeholder="List the key principles, governing rules, or critical considerations. Think: what would you tell a new attorney on their first day working in this area?" required></textarea>
        </div>

        <div class="field">
          <label for="methodology" class="required">What is the standard approach or methodology for this type of work?</label>
          <textarea id="methodology" class="large" placeholder="Walk through how you approach this work from start to finish. What's the typical process, sequence of steps, or analytical framework?" required></textarea>
        </div>

        <div class="field">
          <label for="keyTerms">Key terms, definitions, or concepts <span class="hint">(optional)</span></label>
          <textarea id="keyTerms" placeholder="Are there specific terms, legal definitions, or concepts that are essential to this area? List them with brief explanations."></textarea>
        </div>
      </div>

      <!-- Section 4: Checklists & Procedures -->
      <div class="section" data-step="4">
        <div class="section-header">
          <div class="section-number">4</div>
          <h2>Checklists &amp; Procedures</h2>
        </div>
        <p class="section-description">What should always be done, checked, or included.</p>

        <div class="field">
          <label for="checklist" class="required">What should always be checked, verified, or included in work product for this area?</label>
          <textarea id="checklist" class="large" placeholder="List the items that should be on every checklist. Think: what would you be embarrassed to miss? What does due diligence look like here?" required></textarea>
        </div>

        <div class="field">
          <label for="procedures">Standard procedures or required filings <span class="hint">(optional)</span></label>
          <textarea id="procedures" placeholder="Are there standard procedures, government filings, registration requirements, or formal steps that must be completed?"></textarea>
        </div>

        <div class="field">
          <label for="templates">Standard documents, templates, or forms <span class="hint">(optional)</span></label>
          <textarea id="templates" placeholder="Are there standard documents, template agreements, court forms, or boilerplate language commonly used in this area?"></textarea>
        </div>
      </div>

      <!-- Section 5: Pitfalls, Risks & Jurisdictional Issues -->
      <div class="section" data-step="5">
        <div class="section-header">
          <div class="section-number">5</div>
          <h2>Pitfalls, Risks &amp; Jurisdictional Issues</h2>
        </div>
        <p class="section-description">What goes wrong and what to watch for.</p>

        <div class="field">
          <label for="mistakes" class="required">What are the most common mistakes or oversights in this area?</label>
          <textarea id="mistakes" class="large" placeholder="What do less experienced attorneys typically get wrong? What mistakes have you seen cause real problems? What's easy to overlook?" required></textarea>
        </div>

        <div class="field">
          <label for="redFlags" class="required">What are the biggest risk areas or red flags to watch for?</label>
          <textarea id="redFlags" placeholder="What fact patterns, contract terms, or situations should immediately trigger heightened scrutiny or concern?" required></textarea>
        </div>

        <div class="field">
          <label for="jurisdictional">Jurisdictional considerations <span class="hint">(optional)</span></label>
          <textarea id="jurisdictional" placeholder="Are there jurisdiction-specific rules, variations, or requirements? Any states or jurisdictions with notably different approaches?"></textarea>
        </div>
      </div>

      <!-- Section 6: Quality & Client Communication -->
      <div class="section" data-step="6">
        <div class="section-header">
          <div class="section-number">6</div>
          <h2>Quality &amp; Client Communication</h2>
        </div>
        <p class="section-description">What separates great work from adequate work.</p>

        <div class="field">
          <label for="quality">What separates excellent work from adequate work in this area?</label>
          <textarea id="quality" placeholder="What's the difference between a competent job and an outstanding one? What do the best practitioners do that others don't?"></textarea>
        </div>

        <div class="field">
          <label for="clientComm">What do clients most need to understand about this area?</label>
          <textarea id="clientComm" placeholder="What are the most important things to communicate to clients? What misconceptions do clients commonly have? What should a client-facing email always address?"></textarea>
        </div>
      </div>

      <!-- Section 7: References & Resources -->
      <div class="section" data-step="7">
        <div class="section-header">
          <div class="section-number">7</div>
          <h2>References &amp; Resources</h2>
        </div>
        <p class="section-description">Key authorities, statutes, and resources.</p>

        <div class="field">
          <label for="statutes">Key statutes, regulations, or cases <span class="hint">(optional)</span></label>
          <textarea id="statutes" placeholder="List the most important statutes, regulations, case law, or regulatory guidance that governs this area."></textarea>
        </div>

        <div class="field">
          <label for="resources">Other resources or references <span class="hint">(optional)</span></label>
          <textarea id="resources" placeholder="Any treatises, practice guides, industry standards, or other resources that are essential references?"></textarea>
        </div>
      </div>

      <!-- Section 8: Additional Knowledge -->
      <div class="section" data-step="8">
        <div class="section-header">
          <div class="section-number">8</div>
          <h2>Anything Else</h2>
        </div>
        <p class="section-description">Catch-all for knowledge that didn't fit above.</p>

        <div class="field">
          <label for="additional">Is there anything else we should know about this area?</label>
          <textarea id="additional" class="large" placeholder="Anything we didn't ask about? War stories, edge cases, things only someone with deep experience would know? This is your chance to share anything else that matters."></textarea>
        </div>
      </div>

    </form>

    <!-- Navigation buttons (outside form to prevent submit) -->
    <div class="nav-buttons" id="navButtons" style="display:none;">
      <div class="left">
        <button class="btn btn-outline" id="backBtn" onclick="goBack()">Back</button>
        <button class="btn btn-save-exit" onclick="saveAndExit()">Save &amp; Exit</button>
      </div>
      <div class="right">
        <button class="btn btn-primary" id="nextBtn" onclick="goNext()">Save &amp; Continue</button>
      </div>
    </div>

    <!-- Completion screen -->
    <div class="completion-screen" id="completionScreen">
      <div class="completion-card">
        <div class="check-icon">&#x2713;</div>
        <h2>Ready to submit!</h2>
        <p>You've completed all 8 sections. Review your answers if you'd like, then hit Submit to send your expertise to the Mavacy team.</p>

        <div class="completion-actions">
          <button class="btn btn-primary" id="submitBtn" onclick="submitForm()">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 2L11 13"/><polygon points="22,2 15,22 11,13 2,9"/></svg>
            Submit
          </button>
          <button class="btn btn-outline" onclick="goToStep(1)">Review Answers</button>
        </div>
      </div>
    </div>

    <!-- Thank you screen (shown after successful submission) -->
    <div class="completion-screen" id="thankYouScreen">
      <div class="completion-card">
        <div class="check-icon" style="background:rgba(72,187,120,0.15);">&#x2713;</div>
        <h2>Thank you!</h2>
        <p>Your expertise has been submitted to the Mavacy team. We'll review it and integrate it into our knowledge system. If we have follow-up questions, we'll reach out.</p>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ─── State ───────────────────────────────────────────────
    const TOTAL_STEPS = 8;
    let currentStep = 0; // 0 = welcome screen
    const sections = document.querySelectorAll('.section[data-step]');
    const SECTION_NAMES = [
      '', 'About You', 'Scope & Application', 'Core Knowledge',
      'Checklists & Procedures', 'Pitfalls & Risks',
      'Quality & Communication', 'References', 'Anything Else'
    ];

    // ─── Build step dots ─────────────────────────────────────
    const dotsContainer = document.getElementById('stepDots');
    for (let i = 1; i <= TOTAL_STEPS; i++) {
      const dot = document.createElement('div');
      dot.className = 'step-dot';
      dot.textContent = i;
      dot.onclick = () => {
        // Allow clicking to completed steps or the next available step
        if (i <= getMaxReachedStep()) goToStep(i);
      };
      dotsContainer.appendChild(dot);
    }

    function getMaxReachedStep() {
      // Allow navigation to any step they've visited
      const saved = localStorage.getItem('mavacy_sme_max_step');
      return saved ? Math.max(parseInt(saved), currentStep) : currentStep;
    }

    function saveMaxStep() {
      const prev = parseInt(localStorage.getItem('mavacy_sme_max_step') || '0');
      if (currentStep > prev) {
        localStorage.setItem('mavacy_sme_max_step', currentStep.toString());
      }
    }

    // ─── Navigation ──────────────────────────────────────────
    function startForm() {
      const savedStep = parseInt(localStorage.getItem('mavacy_sme_current_step') || '1');
      goToStep(savedStep);
    }

    function goToStep(step) {
      // Validate current step's required fields before advancing
      if (currentStep > 0 && step > currentStep && !validateCurrentStep()) return;

      saveToStorage();
      currentStep = step;
      saveMaxStep();
      localStorage.setItem('mavacy_sme_current_step', step.toString());

      // Hide everything
      document.getElementById('welcomeScreen').classList.remove('active');
      document.getElementById('completionScreen').classList.remove('active');
      sections.forEach(s => s.classList.remove('active'));

      if (step > TOTAL_STEPS) {
        // Show completion screen
        document.getElementById('completionScreen').classList.add('active');
        document.getElementById('navButtons').style.display = 'none';
        document.getElementById('stepProgress').style.display = 'block';
        updateStepUI(TOTAL_STEPS);
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return;
      }

      // Show step
      const section = document.querySelector(`.section[data-step="${step}"]`);
      if (section) section.classList.add('active');

      // Show nav and progress
      document.getElementById('stepProgress').style.display = 'block';
      document.getElementById('navButtons').style.display = 'flex';

      // Update buttons
      document.getElementById('backBtn').style.display = step === 1 ? 'none' : '';
      document.getElementById('nextBtn').textContent = step === TOTAL_STEPS ? 'Finish' : 'Save & Continue';

      updateStepUI(step);
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Focus first input in this step
      const firstInput = section.querySelector('input, select, textarea');
      if (firstInput) setTimeout(() => firstInput.focus(), 350);
    }

    function goNext() {
      if (!validateCurrentStep()) return;
      saveToStorage();
      showToast('Saved!', 1500);
      goToStep(currentStep + 1);
    }

    function goBack() {
      saveToStorage();
      if (currentStep > 1) goToStep(currentStep - 1);
    }

    function saveAndExit() {
      saveToStorage();
      showToast('Progress saved! You can close this tab and come back anytime.', 5000);
    }

    // ─── Step UI updates ─────────────────────────────────────
    function updateStepUI(step) {
      const displayStep = Math.min(step, TOTAL_STEPS);
      const pct = Math.round((displayStep / TOTAL_STEPS) * 100);

      document.getElementById('stepTitle').textContent = step > TOTAL_STEPS
        ? 'Complete!'
        : `Step ${displayStep} of ${TOTAL_STEPS} \u2014 ${SECTION_NAMES[displayStep]}`;
      document.getElementById('stepPercent').textContent = pct + '%';
      document.getElementById('stepFill').style.width = pct + '%';

      // Update dots
      const maxReached = getMaxReachedStep();
      const dots = dotsContainer.children;
      for (let i = 0; i < dots.length; i++) {
        const dotStep = i + 1;
        dots[i].className = 'step-dot';
        if (dotStep === displayStep) {
          dots[i].classList.add('active');
        } else if (dotStep < displayStep || dotStep <= maxReached) {
          dots[i].classList.add('completed');
        }
        dots[i].style.cursor = dotStep <= maxReached ? 'pointer' : 'default';
      }
    }

    // ─── Validation (per step) ───────────────────────────────
    function validateCurrentStep() {
      const section = document.querySelector(`.section[data-step="${currentStep}"]`);
      if (!section) return true;

      const required = section.querySelectorAll('[required]');
      let valid = true;

      required.forEach(f => {
        if (!f.value.trim()) {
          f.style.borderColor = '#e53e3e';
          valid = false;
        } else {
          f.style.borderColor = '';
        }
      });

      if (!valid) {
        showToast('Please fill in the required fields before continuing.');
        const first = section.querySelector('[required][style*="border-color: rgb(229, 62, 62)"]');
        if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
      return valid;
    }

    // ─── Toast notifications ─────────────────────────────────
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), duration);
    }

    // ─── Submit to Google Apps Script ───────────────────────
    const SUBMIT_URL = 'https://script.google.com/macros/s/AKfycbxNFUjEBoT13ecSRoB35sn-dffTiBz5iA6k2o4yWsdr5SW2q181Gwwyf2tKhW6znreAYA/exec';

    function submitForm() {
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.innerHTML = '<span>Submitting...</span>';

      // Collect all form field values
      const v = (id) => document.getElementById(id).value.trim();
      const data = {
        expertName: v('expertName'),
        expertTitle: v('expertTitle'),
        expertEmail: v('expertEmail'),
        expertiseArea: v('expertiseArea'),
        experienceYears: v('experienceYears'),
        scope: v('scope'),
        triggers: v('triggers'),
        principles: v('principles'),
        methodology: v('methodology'),
        keyTerms: v('keyTerms'),
        checklist: v('checklist'),
        procedures: v('procedures'),
        templates: v('templates'),
        mistakes: v('mistakes'),
        redFlags: v('redFlags'),
        jurisdictional: v('jurisdictional'),
        quality: v('quality'),
        clientComm: v('clientComm'),
        statutes: v('statutes'),
        resources: v('resources'),
        additional: v('additional')
      };

      fetch(SUBMIT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(() => {
        // Clear saved data after successful submission
        try {
          localStorage.removeItem(STORAGE_KEY);
          localStorage.removeItem('mavacy_sme_current_step');
          localStorage.removeItem('mavacy_sme_max_step');
        } catch(e) {}

        // Show thank you screen
        document.getElementById('completionScreen').classList.remove('active');
        document.getElementById('thankYouScreen').classList.add('active');
        document.getElementById('stepProgress').style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      })
      .catch(() => {
        btn.disabled = false;
        btn.innerHTML = '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 2L11 13"/><polygon points="22,2 15,22 11,13 2,9"/></svg> Submit';
        showToast('Something went wrong. Please try again.', 5000);
      });
    }

    // ─── Auto-save to localStorage ──────────────────────────
    const STORAGE_KEY = 'mavacy_sme_draft';

    function saveToStorage() {
      const data = {};
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.id) data[el.id] = el.value;
      });
      // Also save the current step position with the form data
      if (currentStep > 0) {
        data._currentStep = currentStep;
        data._maxStep = getMaxReachedStep();
      }
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch(e) { /* storage full or unavailable */ }
    }

    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const data = JSON.parse(raw);
        let hasData = false;
        Object.keys(data).forEach(key => {
          if (key === '_currentStep' || key === '_maxStep') return;
          const el = document.getElementById(key);
          if (el && data[key]) {
            el.value = data[key];
            hasData = true;
          }
        });
        // Restore step position
        if (data._currentStep) {
          localStorage.setItem('mavacy_sme_current_step', data._currentStep.toString());
        }
        if (data._maxStep) {
          localStorage.setItem('mavacy_sme_max_step', data._maxStep.toString());
        }
        return hasData;
      } catch(e) { return false; }
    }

    // Auto-save every 5 seconds
    setInterval(saveToStorage, 5000);
    // Also save on input
    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('input', saveToStorage);
      el.addEventListener('change', saveToStorage);
    });

    // Clear border on input
    document.querySelectorAll('[required]').forEach(f => {
      f.addEventListener('input', () => { f.style.borderColor = ''; });
    });

    // Save on tab close / navigate away
    window.addEventListener('beforeunload', () => {
      saveToStorage();
    });

    // ─── Init ────────────────────────────────────────────────
    window.addEventListener('DOMContentLoaded', () => {
      const hasData = loadFromStorage();
      if (hasData) {
        document.getElementById('welcomeResume').style.display = 'block';
        document.getElementById('startBtn').textContent = 'Continue Where You Left Off';
      }
    });
  </script>

</body>
</html>
